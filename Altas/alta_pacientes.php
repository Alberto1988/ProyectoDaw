<?php require('../Aspecto/libreria.inc');cabecera_alta();function LimpiaResultados($objeto){	foreach ($objeto as $atributo => $valor)		if(is_string($objeto->$atributo) === true)			$objeto->$atributo = stripslashes($objeto->$atributo);}class ExcepcionEnTransaccion extends Exception{	public function __construct(){}}?><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN"><html><head>	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">	<title>Alta Usuarios</title>	<script type="text/javascript" src="../Javascript/altas.js"></script></head><body><?phpif (isset($_GET['alta'])===false) {?><form action="<?php echo $_SERVER['PHP_SELF'] ?>" method="get" name="formulario" onSubmit="return validar()">	<TABLE>		<TR>			<TD>Clave:</TD>			<TD><INPUT TYPE="text" NAME="clave" SIZE="20" MAXLENGTH="30"></TD>		</TR>		<TR>			<TD>Nombre:</TD>			<TD><INPUT TYPE="text" onkeypress="return soloLetras(event)" NAME="nombre" SIZE="20" MAXLENGTH="30"></TD>		</TR>		<TR>			<TD>Apellido Paterno:</TD>			<TD><INPUT TYPE="text" NAME="ap_paterno" onkeypress="return soloLetras(event)" SIZE="20" MAXLENGTH="30"></TD>		</TR>		<TR>			<TD>Apellido Materno:</TD>			<TD><INPUT TYPE="text" NAME="ap_materno" onkeypress="return soloLetras(event)" SIZE="20" MAXLENGTH="30"></TD>		</TR>		<TR>			<TD>Sexo:</TD>			<TD><select name="tiposexo">					<option value="M" selected="selected">M</option>					<option value="F">F</option>				</select>			</TD>		</TR>		<TR>			<TD>Domicilio:</TD>			<TD><INPUT TYPE="text" NAME="domicilio" SIZE="20" MAXLENGTH="30"></TD>		</TR>		<TR>			<TD>Usuario Paciente:</TD>			<TD><INPUT TYPE="text" NAME="us_paciente" SIZE="20" MAXLENGTH="30"></TD>		</TR>		<TR>			<TD>Contrase&ntildea Paciente:</TD>			<TD><INPUT TYPE="text" NAME="ct_paciente" SIZE="20" MAXLENGTH="30"></TD>		</TR>		<TR>			<TD><INPUT TYPE="submit" NAME="alta" VALUE="Alta"></TD>		</TR>	</TABLE></FORM><?php}else { $clave=$_GET['clave'];$nombre=$_GET['nombre'];$ap_paterno=$_GET['ap_paterno']; $ap_materno=$_GET['ap_materno'];$sexo=$_GET['tiposexo']; $domicilio=$_GET['domicilio'];$us_paciente=$_GET['us_paciente']; $ct_paciente=$_GET['ct_paciente'];try{	@ $db = new mysqli('localhost', 'root', 'root');	if (mysqli_connect_errno() != 0)		throw new Exception('Error conectando:'.mysqli_connect_error(), mysqli_connect_errno());		$db->select_db('clinica');	if ($db->errno != 0)		throw new Exception('Error seleccionando bd:'.$db->error, $db->errno);		$consulta = "insert into pacientes(clave,nombre,apellido_paterno,apellido_materno,sexo,domicilio,usu_paciente,pass_paciente) values ('$clave','$nombre','$ap_paterno','$ap_materno','$sexo','$domicilio','$us_paciente','$ct_paciente')";	if ($db->query($consulta) === false)		throw new ExcepcionEnTransaccion();	$db->commit();		$consulta = "select clave,nombre,apellido_paterno,apellido_materno,sexo,domicilio,usu_paciente,pass_paciente from pacientes";	$resultado = $db->query($consulta);	if ($db->errno != 0)		throw new Exception('Error realizando consulta:'.$db->error, $db->errno);	assert($resultado !== false);	if ($resultado->num_rows > 0){			echo '<table id="med" border="1">';			echo'<tr>';				echo'<th>Clave</th>';				echo'<th>Nombre</th>';				echo'<th>Apellido Paterno</th>';				echo'<th>Apellido Materno</th>';				echo'<th>Sexo</th>';				echo'<th>Domicilio</th>';				echo'<th>Usuario</th>';				echo'<th>Contrase&ntildea</th>';			echo'</tr>';			while ($obj = $resultado->fetch_object()){				LimpiaResultados($obj);				echo'<tr>';					echo'<td align="center">'.$obj->clave.'</td>';					echo'<td align="center">'.$obj->nombre.'</td>';					echo'<td align="center">'.$obj->apellido_paterno.'</td>';					echo'<td align="center">'.$obj->apellido_materno.'</td>';					echo'<td align="center">'.$obj->sexo.'</td>';					echo'<td align="center">'.$obj->domicilio.'</td>';					echo'<td align="center">'.$obj->usu_paciente.'</td>';					echo'<td align="center">'.$obj->pass_paciente.'</td>';				echo'</tr>';			}			echo'</table>';		}	else echo '<p>No hay datos que mostrar</p>';	?>	<p id="n_alta">[<a href="<?php echo $_SERVER['PHP_SELF'] ?>">Nueva alta</a>]</p>	<?php	$resultado->free(); 	$db->close(); }catch (ExcepcionEnTransaccion $e){	echo 'No se ha podido realizar el alta';	$db->rollback();	$db->close();}catch (Exception $e){	echo $e->getMessage();	if (mysqli_connect_errno() == 0)		$db->close();	exit();}}?></body></html>